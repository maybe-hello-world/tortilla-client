<!DOCTYPE HTML>
<html>
<meta charset="UTF-8">
<head>
    <title>Guacamole</title>
</head>

<body>

<!-- ctrl alt del button -->
<input id="cad" value="Ctrl+Alt+Del" type="button">
<br>

<!-- Guacamole -->
<script type="text/javascript"
        src="guacamole-common-js/all.min.js"></script>

<!-- Display -->
<div id="display"></div>

<!-- Init -->
<script type="text/javascript"> /* <![CDATA[ */

    // Function to parse URL parameters
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    // Get display div from document
    var display = document.getElementById("display");

    // Instantiate client, using an HTTP tunnel for communications.
    var guac = new Guacamole.Client(
        new Guacamole.HTTPTunnel("tunnel")
    );

    // Add client to display div
    display.appendChild(guac.getDisplay().getElement());

    // Error handler
    guac.onerror = function (error) {
        console.log(error);
        alert(error.message);
    };

    url =   'domain=' + localStorage.getItem("guac.domain") +
            '&username=' + localStorage.getItem("guac.username") +
            '&password=' + localStorage.getItem("guac.password") +
            '&server=' + getParameterByName("server") +
            '&protocol=' + getParameterByName("protocol") +
            '&port=' + getParameterByName("port");

    if (getParameterByName("protocol").toLowerCase() === "vmrdp") {
        url = url + "&vmid=" + getParameterByName("vmid");
    }

    // Connect
    guac.connect(url);

    // Disconnect on close
    window.onunload = function () {
        guac.disconnect();
    };

    // Mouse
    var mouse = new Guacamole.Mouse(guac.getDisplay().getElement());

    mouse.onmousedown =
        mouse.onmouseup =
            mouse.onmousemove = function (mouseState) {
                guac.sendMouseState(mouseState);
            };

    // Keyboard
    var keyboard = new Guacamole.Keyboard(document);

    keyboard.onkeydown = function (keysym) {
        guac.sendKeyEvent(1, keysym);
    };

    keyboard.onkeyup = function (keysym) {
        guac.sendKeyEvent(0, keysym);
    };


    // Ctrl + Alt + Del button
    function ctrl_alt_del() {
        guac.sendKeyEvent(1, 0xFFE3);
        guac.sendKeyEvent(1, 0xFFE9);
        guac.sendKeyEvent(1, 0xFFFF);
        guac.sendKeyEvent(0, 0xFFE3);
        guac.sendKeyEvent(0, 0xFFE9);
        guac.sendKeyEvent(0, 0xFFFF);
    }

    var cad_btn = document.getElementById("cad");
    cad_btn.onclick = ctrl_alt_del;

/* ]]> */ </script>

</body>

</html>